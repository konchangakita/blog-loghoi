# blog-loghoi プロジェクト方針

## プロジェクト概要
このプロジェクトは「Nutanixログホイホイ」ブログシリーズのコード置き場です。
ログ収集・分析システムの開発・検証用リポジトリとして、ブログ記事と連動した開発履歴を管理しています。

## コードスタイル

### Python
- すべての新規ファイルで型ヒントを使用する
- **FastAPI**: 今後の新規開発はすべてFastAPIを使用
- **Flask**: 過去開発のコードのみ（新規開発では使用禁止）
- データベースのカラム名は snake_case を使用する
- PEP 8 に準拠する
- 関数・クラスにはdocstringを記述する
- 非同期処理を積極的に活用する

### JavaScript/TypeScript
- すべての新規ファイルで TypeScript を使用する
- React では関数コンポーネントを優先する
- ESLint、Prettierの設定に従う
- コンポーネントは名前付きエクスポートを使用する

## アーキテクチャ

### バックエンド
- リポジトリパターンに従う
- ビジネスロジックはサービス層に置く
- エラーハンドリング用ミドルウェアを含める
- 適切なロギングを設定する

### フロントエンド
- コンポーネントベースの設計
- 状態管理は適切なライブラリを使用
- レスポンシブデザインを意識する
- アクセシビリティを考慮する

### インフラ
- Docker コンテナ化を基本とする
- Kubernetes でのデプロイを想定
- 環境変数による設定管理
- セキュリティベストプラクティスに従う

## 開発ワークフロー

### ブランチ戦略（GitFlow運用 - 現在の状況）
- `main`: 本番リリース専用。直接コミット禁止。
- `refactor`: **メイン開発ブランチ**（developの役割も兼ねる）。PR経由でのみ変更。
  - kubernetes化までのリファクタリング作業
  - 新機能開発の統合ブランチ
- `feature/*`: 新機能開発用。作業完了後、refactorにPRを出す。
- `hotfix/*`: 本番バグ修正用。mainとrefactorにマージする。
- `release/*`: リリース前テスト。refactorから分岐し、mainへマージ後削除。

### 将来的なブランチ戦略（リファクタリング完了後）
- `develop`: 次期リリース候補。PR経由でのみ変更。
- `refactor`: リファクタリング専用ブランチ（段階的に廃止予定）

### コミット規約（Conventional Commits）
- Conventional Commits形式を使用する
- 例: `feat: 新機能追加`
- 例: `fix: バグ修正`
- 例: `docs: ドキュメント修正`
- 例: `refactor: 構造変更`
- 例: `chore: ビルド/依存関連更新`

### Pull Request運用
- **🚨 重要: すべてのfeatureブランチは必ずPR経由でrefactorにマージ**
- **PRを作成せずに直接マージすることは禁止**
- PR作成手順:
  1. featureブランチをリモートにpush: `git push origin feature/xxx`
  2. GitHub上でPRを作成（または`gh pr create`コマンド使用）
  3. PRテンプレートに従って説明を記載
  4. レビュー承認後にマージ
  5. ローカルブランチをクリーンアップ: `git branch -d feature/xxx`
- すべてのPRには最低1人のレビューアが必要
- PRタイトルは関連チケット番号を含める
- 自動テストが通らない限りマージ禁止

### コードレビュー & テスト
- 新機能はユニットテストを含めること
- LinterとFormatterを実行してからPRを作成する
- 影響範囲がある場合はdevelopで統合テストを行う
- 単体テスト、統合テストを適切に実装する
- pytest（Python）、Jest（JavaScript）を使用する
- テストカバレッジを意識する

### 制限事項
以下は禁止されています：
- ❌ refactorブランチに直接コミット（現在のメイン開発ブランチ）
  - **例外**: 軽微なドキュメント更新、ルールファイル更新は直接コミット可
- ❌ mainブランチでのpush
- ❌ **PRを作成せずにfeatureブランチをrefactorに直接マージ**
  - `git merge`コマンドでの直接マージは禁止
  - 必ずPRを作成してからマージすること
- ❌ コミットメッセージに「test」や「tmp」と書く
- ❌ --no-verify フラグの使用（特別な理由がない限り）
- **すべての更新は`ongoing/`フォルダ配下で行うこと**
  - `blog/`フォルダは過去のブログ記事対応履歴のため、直接編集禁止
  - 新しい機能開発や修正は必ず`ongoing/`配下で実施

### 例外: refactorブランチへの直接コミットが許可されるケース
- ✅ 軽微なドキュメント更新（誤字修正、進捗記録等）
- ✅ ルールファイルの更新（`.cursor/rules/*.mdc`, `AGENTS.md`等）
- ✅ 設定ファイルの軽微な修正
- ❌ コード実装、依存関係変更、大規模変更は必ずPR経由

### 将来的な制限事項（developブランチ作成後）
- developブランチに直接コミット（同様の例外あり）

## ブログ連携
- ブログ記事とコードの対応関係を明確にする
- 変更履歴を適切に管理する
- 実験的機能は適切にラベル付けする
- 本番環境への影響を考慮する
