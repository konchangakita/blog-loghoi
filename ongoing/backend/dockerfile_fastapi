FROM python:3.11.4-slim

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

RUN apt-get update -y \
    && apt-get install -y --no-install-recommends \
       curl \
       ssh-client \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /usr/src

# Install deps first (use fastapi-specific requirements)
COPY ./requirements_fastapi.txt /usr/src/requirements_fastapi.txt
RUN pip install --upgrade pip \
    && pip install -r /usr/src/requirements_fastapi.txt

# Copy application code
COPY ./fastapi_app /usr/src/fastapi_app
COPY ./core /usr/src/core
COPY ./config /usr/src/config
ENV PYTHONPATH=/usr/src:/usr/src/shared
WORKDIR /usr/src/fastapi_app

EXPOSE 7776

CMD ["python", "-m", "uvicorn", "app_fastapi:socket_app", "--host", "0.0.0.0", "--port", "7776"]




